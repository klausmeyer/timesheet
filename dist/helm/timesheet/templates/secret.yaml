apiVersion: v1
kind: Secret
metadata:
  name: {{ include "timesheet.fullname" . }}
  labels:
    {{- include "timesheet.labels" . | nindent 4 }}
type: Opaque
data:
  SECRET_KEY_BASE: {{ required "Missing value for .Values.application.secret_key_base" .Values.application.secret_key_base | b64enc }}
{{- if .Values.postgres.enabled }}
  DATABASE_URL: {{ printf "postgres://%s:%s@%s-%s:%s/%s" .Values.postgres.userDatabase.user .Values.postgres.userDatabase.password (include "timesheet.fullname" .) "postgres" "5432" .Values.postgres.userDatabase.name | b64enc }}
{{- else }}
  DATABASE_URL: {{ printf "postgres://%s:%s@%s:%s/%s" .Values.database.user .Values.database.password .Values.database.host .Values.database.port .Values.database.name | b64enc }}
{{- end }}
